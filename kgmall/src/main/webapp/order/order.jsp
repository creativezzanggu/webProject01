<%@ page language="java" contentType="text/html; charset=UTF-8"
    pageEncoding="UTF-8"%>
<!DOCTYPE html>
<link href="//fonts.googleapis.com/css?family=Lato:400,700" rel="stylesheet">
<link rel="stylesheet" type="text/css" href="http://ecudemo31431.cafe24.com/ind-script/optimizer.php?filename=tZVLUsMwDIb3TrecQ4TCIVhzAsdWEoNtGcmG9va4Tel06IbJOIvM2Er0_Rk9YaaA0D8xJKaJdQBGocIGwYjAyBQzGAqB4q4aHuA_36NRQr5kR1ENdFjpWHJeK-r1EXmda9aDxxtXNF0RZKmHYjHQvn_e95DK4J3p5hw8iMXOorgpgny42PdnciBbPAKxRYaROLRmWvMaR9riT7ukjwFjNpptO37NCZUMofjsZKb0NruUXJyaKxiKXxVSk5lM6_BU9uhqhP4W2Bq4HT0RnzWWBqsWdddqzchLdLYgF7cJVXAL7KAFVXbZb0e_m1xt8XWQ2WKy8k4apXN5W00gUU7P40sbcPJlcktd64wT8fH23FQDD2o4iHenLn3_LFjxv_fWOmKYvB_0VehqaKOkU6qbqS4m_V13VbhsqnpXF8MuuIbldSILRB1LmCjP7jw0fwA&amp;type=css&amp;k=5a2cfe3637fd16c56a9dc09ed67856ec87d42058&amp;t=1559179802">
<link rel="stylesheet" type="text/css" href="http://ecudemo31431.cafe24.com/ind-script/optimizer.php?filename=tZBBEsIwCEX3rVvPgbEew0u0CW0yJiETwLG3N1U3rq0r4DHzYD54Sghoe2Ws3Bp1mGgwl8FA0SkG23tJEdhh75DDkoFvIRsDbo5EFSwzzJSFodJEQocGjrCH1VJKlBvpKnKhzOGO_7BbZaH0o3lTJnIaEeK4kgokjRLYU7kGln3-fm8bAsaxWv8pp_M--hJ1Ca9I5vCYxpyxfg2drAXNdusJ&amp;type=css&amp;k=7a4bca05015a6c9fb0ab94ac6acba78b11993f9e&amp;t=1556261055">
<link rel="stylesheet" type="text/css" href="http://ecudemo31431.cafe24.com/ind-script/optimizer.php?filename=nc1LCoAwDIThvbj1HEFv1Ib4gKYjSQp6e_UG0u3wfwztUKF5MToNmyUlE0czFmJ3Wg01iKGKOr7DRH964cFRWhyoQ8bVCVtE72lJt1gfjZSLfPQB&amp;type=css&amp;k=6ff09804d00b24cef12b4ab8b2a6e5c2fc3eb52b&amp;t=1508869437">
<style type="text/css">
                .eximbayInfo { width:330px; margin:0 auto; padding:20px 0 40px; }
                .eximbayInfo h4 { color:#000; font-size:22px; font-family:gulim, sans-serif; text-align:center; }
                .eximbayInfo ul { margin:15px 0 0; color:#747474; font-size:11px; line-height:1.5; }
                .eximbayInfo li { margin:6px 0 0; padding:0 0 0 10px; background:url('//img.echosting.cafe24.com/design/skin/default/common/ico_list.gif') no-repeat 0 5px; }
                .axesInfo { display:none; overflow:hidden; position:absolute; z-index:100; width:380px; border:1px solid #7f8186; color:#000; }
                .axesInfo h3 { height:39px; padding:0 35px 0 19px; color:#fefefe; font-size:14px; line-height:39px; background-color:#666; }
                .axesInfo .content { padding:20px; background-color:#fff; }
                .axesInfo .close { position:absolute; right:14px; top:12px; }
                .axesInfo .close img { cursor:pointer; }
                .axesInfo .btnArea { margin:0; padding:10px 0; border-top:1px solid #c7ccd2; text-align:center; background:#e5e5e5; }
                .axesInfo h4 { padding:10px 0 0; color:#000; font-size:22px; font-family:gulim, sans-serif; text-align:center; }
                .axesInfo ul { margin:15px 0 0; padding:0 0 10px; border:0; color:#747474; font-size:11px; line-height:1.5; }
                .axesInfo li { margin:6px 0 0; padding:0 0 0 10px; background:url('//img.echosting.cafe24.com/design/skin/default/common/ico_list.gif') no-repeat 0 5px; }
</style>
<div id="contents">
			
<!-- 업데이트 2017-03-05 -->
<div class="location-subpage">
	<div class="path-subpage">
		<h2>현재 위치</h2>
		<ol><li><a href="/"><!--
한국어: 홈 or Home
영  어: Home
중국어: 首页
일본어: ホーム
-->
Home</a></li>
			<li title="현재 위치"><strong>주문서작성</strong></li>
		</ol></div>
	<div class="tit-subpage">
		<h2>주문서작성</h2>
	</div>
</div>

<form id="frm_order_act" name="frm_order_act" action="" method="post" target="_self" enctype="multipart/form-data">
<input id="move_order_after" name="move_order_after" value="/order/order_result.html" type="hidden">
<input id="isUpdateMemberEmailOrder" name="isUpdateMemberEmailOrder" value="F" type="hidden">
<input id="isSimplyOrderForm" name="isSimplyOrderForm" value="F" type="hidden">
<input id="member_group_price" name="member_group_price" value="0" type="hidden">
<input id="mileage_generate3" name="mileage_generate3" value="0" type="hidden">
<input id="total_group_dc" name="total_group_dc" value="0" type="hidden">
<input id="total_plusapp_mileage_price" name="total_plusapp_mileage_price" value="" type="hidden">
<input id="__ocountry" name="__ocountry" value="   " type="hidden">
<input id="__oaddr1" name="__oaddr1" value="" type="hidden">
<input id="__ocity" name="__ocity" value="" type="hidden">
<input id="__ostate" name="__ostate" value="" type="hidden">
<input id="sSinameZhAreaWord" name="sSinameZhAreaWord" value="省/市" type="hidden">
<input id="sSinameTwAreaWord" name="sSinameTwAreaWord" value="市/縣" type="hidden">
<input id="sGunameZhAreaWord" name="sGunameZhAreaWord" value="区" type="hidden">
<input id="sGunameTwAreaWord" name="sGunameTwAreaWord" value="區/市" type="hidden">
<input id="__faddress" name="__faddress" value="" type="hidden">
<input id="__si_gun_dosi" name="__si_gun_dosi" value="" type="hidden">
<input id="__ju_do" name="__ju_do" value="" type="hidden">
<input id="message_autosave" name="message_autosave" value="F" type="hidden">
<input id="hope_date" name="hope_date" value="" type="hidden">
<input id="hope_ship_begin_time" name="hope_ship_begin_time" value="" type="hidden">
<input id="hope_ship_end_time" name="hope_ship_end_time" value="" type="hidden">
<input id="is_fast_shipping_time" name="is_fast_shipping_time" value="" type="hidden">
<input id="basket_type" name="basket_type" value="A0000" type="hidden">
<input id="productPeriod" name="productPeriod" value="" type="hidden">
<input id="eguarantee_id" name="eguarantee_id" value="F" type="hidden">
<input id="member_id" name="member_id" value="hyun123" type="hidden">
<input id="is_hope_shipping" name="is_hope_shipping" value="F" type="hidden">
<input id="is_fast_shipping" name="is_fast_shipping" value="" type="hidden">
<input id="delvType" name="delvType" value="A" type="hidden">
<input id="fCountryCd" name="fCountryCd" value="" type="hidden">
<input id="sCpnPrd" name="sCpnPrd" value="0" type="hidden">
<input id="sCpnOrd" name="sCpnOrd" value="0" type="hidden">
<input id="coupon_saving" name="coupon_saving" value="0" type="hidden">
<input id="coupon_discount" name="coupon_discount" value="0" type="hidden">
<input id="coupon_shipfee" name="coupon_shipfee" value="0" type="hidden">
<input id="is_no_ozipcode" name="is_no_ozipcode" value="F" type="hidden">
<input id="is_no_rzipcode" name="is_no_rzipcode" value="F" type="hidden">
<input id="is_cashreceipt_displayed_on_screen" name="is_cashreceipt_displayed_on_screen" value="F" type="hidden">
<input id="is_taxrequest_displayed_on_screen" name="is_taxrequest_displayed_on_screen" value="F" type="hidden">
<input id="app_scheme" name="app_scheme" value="" type="hidden">
<input id="is_store" name="is_store" value="" type="hidden">
<input id="defer_commission" name="defer_commission" value="0" type="hidden">
<input id="order_form_simple_type" name="order_form_simple_type" value="F" type="hidden">
<input id="information_agreement_check_val" name="information_agreement_check_val" value="F" type="hidden">
<input id="consignment_agreement_check_val" name="consignment_agreement_check_val" value="F" type="hidden">
<input id="basket_sync_flag" name="basket_sync_flag" value="F" type="hidden">
<input id="gift_selected_item" name="gift_selected_item" value="" type="hidden">
<input id="app_discount_data" name="app_discount_data" value="" type="hidden">
<input id="is_shipping_address_readonly_by_app" name="is_shipping_address_readonly_by_app" value="" type="hidden">
<input id="is_app_shipfee" name="is_app_shipfee" value="F" type="hidden">
<input id="app_shipfee_data" name="app_shipfee_data" value="" type="hidden">
<input id="is_available_shipping_company_by_app" name="is_available_shipping_company_by_app" value="" type="hidden">
<input id="sEleID" name="sEleID" value="total_price||productPeriod||ophone1_1||ophone1_2||ophone1_3||ophone2_1||ophone2_2||ophone2_3||ophone1_ex1||ophone1_ex2||ophone2_ex1||ophone2_ex2||basket_type||oname||oname2||english_oname||english_name||english_name2||input_mile||input_deposit||hope_date||hope_ship_begin_time||hope_ship_end_time||is_fast_shipping_time||fname||fname2||paymethod||eguarantee_flag||eguarantee_ssn1||eguarantee_ssn2||eguarantee_year||eguarantee_month||eguarantee_day||eguarantee_user_gender||eguarantee_personal_agreement||question||question_passwd||delvType||f_country||fzipcode||faddress||fphone1_1||fphone1_2||fphone1_3||fphone1_4||fphone1_ex1||fphone1_ex2||fphone2_ex1||fphone2_ex2||fphone2||fmessage||fmessage_select||rname||rzipcode1||rzipcode2||raddr1||raddr2||rphone1_1||rphone1_2||rphone1_3||rphone2_1||rphone2_2||rphone2_3||omessage||omessage_select||ozipcode1||ozipcode2||oaddr1||oaddr2||oemail||oemail1||oemail2||ocity||ostate||ozipcode||eguarantee_id||coupon_discount||coupon_saving||order_password||is_fast_shipping||fCountryCd||message_autosave||oa_content||gift_use_flag||pname||bankaccount||regno1||regno2||escrow_agreement0||addr_paymethod||member_group_price||chk_purchase_agreement||total_plusapp_mileage_price||mileage_generate3||is_hope_shipping||sCpnPrd||sCpnOrd||coupon_shipfee||np_req_tx_id||np_save_rate||np_save_rate_add||np_use_amt||np_mileage_use_amount||np_cash_use_amount||np_total_use_amount||np_balance_amt||np_use||np_sig||flagEscrowUse||flagEscrowIcashUse||add_ship_fee||total_group_dc||pron_name||pron_name2||pron_oname||faddress2||si_gun_dosi||ju_do||is_set_product||basket_prd_no||move_order_after||is_no_ozipcode||is_no_rzipcode||__ocountry||__oaddr1||__ocity||__ostate||__faddress||__si_gun_dosi||__ju_do||sSinameZhAreaWord||sSinameTwAreaWord||sGunameZhAreaWord||sGunameTwAreaWord||delivcompany||is_store||cashreceipt_user_type||cashreceipt_user_type2||cashreceipt_regist||cashreceipt_user_mobile1||cashreceipt_user_mobile2||cashreceipt_user_mobile3||cashreceipt_reg_no||is_cashreceipt_displayed_on_screen||tax_request_regist||tax_request_name||tax_request_phone1||tax_request_phone2||tax_request_phone3||tax_request_email1||tax_request_email2||tax_request_company_type||tax_request_company_regno||tax_request_company_name||tax_request_president_name||tax_request_zipcode||tax_request_address1||tax_request_address2||tax_request_company_condition||tax_request_company_line||is_taxrequest_displayed_on_screen||isSimplyOrderForm||use_safe_phone||app_scheme||isUpdateMemberEmailOrder||defer_commission||defer_p_name||order_form_simple_type||gmo_order_id||gmo_transaction_id||receiver_id_card_key||receiver_id_card_type||simple_join_is_check||simple_join_agree_use_info||etc_subparam_member_id||etc_subparam_email1||etc_subparam_passwd||etc_subparam_user_passwd_confirm||etc_subparam_passwd_type||etc_subparam_is_sms||etc_subparam_is_news_mail||information_agreement_check_val||consignment_agreement_check_val||remind_id||remind_code||shipping_additional_fee_show||shipping_additional_fee_hide||shipping_additional_fee_name_show||save_paymethod||allat_account_nm||basket_sync_flag||member_id||input_pointfy||set_main_address0||app_discount_data||is_shipping_address_readonly_by_app||is_app_shipfee||app_shipfee_data||is_available_shipping_company_by_app||gift_selected_item" type="hidden"><div class="xans-element- xans-order xans-order-form xans-record-"><!-- 이값은 지우면 안되는 값입니다. ($move_order_after 주문완료페이지 주소 / $move_basket 장바구니페이지 주소)
        $move_order_after=/order/order_result.html
        $move_basket=/order/basket.html
    -->
<!-- 혜택정보 -->
<div class="xans-element- xans-order xans-order-dcinfo ec-base-box typeMember  ">
<div class="information">

            <h3 class="title">주문정보</h3>
            <div class="description">
                <div class="member ">
                    <p><strong><%=(String)session.getAttribute("id")%></strong> 님의, 주문정보입니다.</p>
</div>
               
</div>
        </div>
</div>
<!-- 국내배송상품 주문내역 -->
<div class="orderListArea ">
        <div class="title">
            <h3>국내배송상품 주문내역</h3>
        </div>

        <!-- 기본배송 -->
        <div class="ec-base-table typeList ">
            <table border="1" summary="">
<caption>기본배송</caption>
                <colgroup>
<col style="width:27px" class="">
<col style="width:92px">
<col style="width:30px">
<col style="width:auto">
<col style="width:75px">
<col style="width:98px">
<col style="width:98px">
<col style="width:auto">
</colgroup>
<thead><tr>
<th scope="col" class=""></th>
<th scope="col">주문번호</th>
<th scope="col">이미지</th>
<th scope="col">상품정보</th>
<th scope="col">판매가</th>
<th scope="col">수량</th>
<th scope="col">합계</th>
</tr></thead>
<tfoot class="right"><tr>
<td class=""></td>
                        <td colspan="8">
<span class="gLeft"></span> <strong><span class="displaynone"></span></strong><span class="displaynone"></span> + 배송비 <span id="domestic_ship_fee">0 (무료)</span> <span class="displaynone"> - 상품할인금액 0 </span> = 합계 : <strong class="txtEm gIndent10"><span id="domestic_ship_fee_sum" class="txt18"></span> won</strong> <span class="displaynone"></span>
</td>
                    </tr></tfoot>
                    <tbody class="xans-element- xans-order xans-order-normallist center" id="tablebody">
                 
</tbody>
</table>
</div>

<!-- 선택상품 제어 버튼 --><div class="ec-base-button">
        <span class="gRight">
            <a href="javascript:window.history.back();" class="df-btn normal light">이전페이지</a>
        </span>
    </div>
</div>
</form>		
</div>
	<div class="ec-base-button fs-0">
	  <a href="" class="df-btn big dark mr-3" id="orderBtn">주문하기</a>
	  <a href="" class="df-btn big medium ml-3" id="cancelBtn">취소</a>
	</div>


<script type="text/javascript">
var check=0;//장바구니를 통해서 들어온 값인지 확인

//comma
function addComma(num) {
	  var regexp = /\B(?=(\d{3})+(?!\d))/g;
	  return num.toString().replace(regexp, ',');
}

$(document).ready(function(){
	var name = '${param.name}';
	if(name!=null){
		$.ajax({
			type : 'POST',
			url : '/kgmall/product/selectCookie.do',
			dataType : 'json',
			success : function(data){
				var totalPrice=0;
				var map = data.map;
				var cnt =1;
				$.each(map, function(index, value){
					var str = index.split("_");
					name=str[0];
					$.ajax({
						type : 'POST',
						url : '/kgmall/product/getDTO.do',
						data : "name="+name,
						dataType : 'json',
						success : function(data){
							$("#tablebody").append("<tr class='xans-record-'><td class=''></td><td class=''>"+cnt+"</td><td class='thumb gClearLine'><a href='../product/select.do?name="+data.productDTO.name+"'><img id = '' src='../image/productImage/"+data.productDTO.imageLink+"' alt='' height='50px' width='50px'></a></td><td class='gClearLine'><a id='' href='../product/select.do?name="+data.productDTO.name+"'><strong>"+data.productDTO.name+"</strong>"+"_"+str[1]+"_"+str[2]+"</a></td><td class='right'><div class=''><strong>"+addComma(data.productDTO.price)+" won</strong></div></td><td>"+value+"개"+"</td><td class='right'><strong>"+addComma(value*data.productDTO.price)+" won</strong><div class='displaynone'></div></td><td><div class='txtInfo'><br></div></td><td rowspan='1' class=''></td></tr>");
							cnt++;
							totalPrice = totalPrice+(value*data.productDTO.price);
							$('#domestic_ship_fee_sum').text(addComma(totalPrice));
						}
					});
				});
			}
		});	
	}
	if(name==""){
		check=1;//장바구니를 통해서 들어온 값인지 확인
		$.ajax({
		type : 'POST',
		url : '/kgmall/cart/selectCart.do',
		data : {'id' : '${id}'},
		dataType : 'json',
		success : function(data){
			var list = data.list;
			var totalPrice=0;
			var cnt =1;
			$.each(list, function(index, value){
				var str = value.product.split("_");
				name=str[0];
				$.ajax({
					type : 'POST',
					url : '/kgmall/product/getDTO.do',
					data : "name="+name,
					dataType : 'json',
					success : function(data){
						$("#tablebody").append("<tr class='xans-record-'><td class=''></td><td class=''>"+cnt+"</td><td class='thumb gClearLine'><a href='../product/select.do?name="+data.productDTO.name+"'><img id = '' src='../image/productImage/"+data.productDTO.imageLink+"' alt='' height='50px' width='50px'></a></td><td class='gClearLine'><a id='' href='../product/select.do?name="+data.productDTO.name+"'><strong>"+data.productDTO.name+"</strong>"+"_"+str[1]+"_"+str[2]+"</a></td><td class='right'><div class=''><strong>"+addComma(data.productDTO.price)+" won</strong></div></td><td>"+value.productCount+"개"+"</td><td class='right'><strong>"+addComma(value.productCount*data.productDTO.price)+" won</strong><div class='displaynone'></div></td><td><div class='txtInfo'><br></div></td><td rowspan='1' class=''></td></tr>");

						//$("#tablebody").append("<tr class='alltr' id="+value.product+"><td class=''></td><td class=''></td><td class='thumb gClearLine'><a href='../product/select.do?name="+name+"'><img id = 'productImage' src='../image/productImage/"+data.productDTO.imageLink+"' height='50px' width='50px' onerror='this.src=//img.echosting.cafe24.com/thumb/img_product_small.gif;' alt=''></a></td><td class='gClearLine'><a id='productName' href='../product/select.do?name="+name+"'><strong>"+data.productDTO.name+"</strong>"+"_"+str[1]+"_"+str[2]+"</a></td><td class='right'><div class=''><strong>"+addComma(data.productDTO.price)+" won</strong><p class='displaynone'></p></div></td><td>"+value.productCount+"개"+"</td><td class='right'><strong>"+addComma(value.productCount*data.productDTO.price)+" won</strong><div class='displaynone'></div></td></tr>");
						cnt++;
						totalPrice = totalPrice+(value.productCount*data.productDTO.price);
						$('#domestic_ship_fee_sum').text(addComma(totalPrice));
					}
				}); 
			});
		}
	});
		
	}
});

$('#orderBtn').click(function(){
	var id = '${id}';
	if(check==0){
		$.ajax({
			type : 'POST',
			data : {'id':id},
			url : '/kgmall/product/insertOrderCookie.do'
		});
		$.ajax({
			type : 'POST',
			url : '/kgmall/product/deleteCookie.do'
		});
	}
	else if(check==1){//장바구니를 통해서 결제를 했을 때
		$.ajax({
			type : 'POST',
			data : {'id':id},
			url : '/kgmall/cart/insertCartOrder.do'
		});
	}
	
	location.href='/kgmall/product/orderOk.do';
});
$('#cancelBtn').click(function(){
	$.ajax({
		type : 'POST',
		url : '/kgmall/product/deleteCookie.do'
	});
	location.href='/kgmall/main/index.do'
});
window.onbeforeunload = function() {
	$.ajax({
		type : 'POST',
		url : '/kgmall/product/deleteCookie.do'
	});
}

</script>